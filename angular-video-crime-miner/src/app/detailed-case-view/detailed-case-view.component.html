<div class="page-content">
    <!-- Page navigation and header -->
    <div class="cm-pagenav">
        <div class="prev">
            <a [routerLink]="['/view/']">&laquo; Back to Cases</a>
        </div>
    </div>
    <h1>Case: {{this.getCaseId()}}</h1>

    <!-- Clickable files table -->
    <div class="card">
        <div class="card-head">Files</div>
        <div class="card-body">
            <!-- Clickable file rows -->
            <div class="cm-table">
                <div class="cm-table-header">
                    <div class="iconCol"></div>
                    <div class="titleCol"><b>Title</b></div>
                    <div class="notesCol"><b>Notes</b></div>
                </div>
                <div class="cm-table-body">
                    <div *ngFor="let file of this.getCaseFiles()">
                        <div class="cm-table-row" [class.selected]="file === selectedFile" 
                        (click)="onSelectFile(file)" (dblclick)="onDoubleClickFile(file)">
                            <div class="iconCol"><i class="fal fa-video"></i></div>
                            <div class="titleCol">{{ file.title }}</div>
                            <div class="notesCol" *ngIf="(file.notes).length!=0">{{ file.notes }}</div>
                            <div class="notesCol" *ngIf="(file.notes).length==0">None</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Actions buttons -->
    <div class="card">
        <div class="card-head">Actions</div>
        <div class="card-body">
            <div class="actions">
                <button class="cm-standard-button" (click)="openUploadFilePopup()">Upload new file</button>
                <!--<button class="cm-standard-button" (click)="openEditCasePopup()">Edit case details</button>-->
                <button class="cm-standard-button" (click)="openViewLabelJobsPopup()">View all label detection jobs</button>
                <button class="cm-standard-button" (click)="openStartLabelJobPopup()">Start new label detection</button>
            </div>
        </div>
    </div>
</div>

<!-- POPUPS -->
<!-- Popup for uploading a new file -->
<div class="cm-popup" *ngIf="showUploadFilePopup">
    <div class="cm-popup-content" >
        <div class="cm-popup-close" (click)="closeUploadFilePopup()">
        &times; <!-- &times; is the X icon -->
        </div>
        <h4>Upload New File</h4>
        <!--
        <div [(ngModel)]="successMessage">{{successMessage}}</div>
        <div [(ngModel)]="errorMessage">{{errorMessage}}</div>
        -->
        <label class="btn btn-default p-0">
            <input type="file" (change)="selectFile($event)"/>
        </label>
        <button class="cm-standard-button" [disabled]="!selectedFiles" (click)="upload()"> Upload </button>
        <div *ngIf="currentFile" class="progress-bar">
            <div
            class="progress-bar"
            role="progressbar"
            attr.aria-valuenow="{{ progress }}"
            aria-valuemin="0"
            aria-valuemax="100"
            [ngStyle]="{ width: progress + '%' }"
            >
            {{ progress }}%
            </div>
        </div>
        <div *ngIf="message" class="alert alert-secondary" role="alert">{{ message }}</div>
    </div>
</div>

<!-- Popup for editing case details -->

<div class="cm-popup" *ngIf="showEditCasePopup">
    <div class="cm-popup-content" >
        <div class="cm-popup-close" (click)="closeEditCasePopup()">
        &times; <!-- &times; is the X icon -->
        </div>
        <h4>Edit Case Details</h4>
			<div class="form-group">
				<label for="name"><span>*</span> Name</label>
				<input [(ngModel)]="name" placeholder="Enter case name" type="text" cols="5" rows="5" name="case name" id="name" aria-required="true" aria-invalid="true" required>
			</div>

			<div class="form-group">
				<label for="tags"><span>*</span> tags</label>
				<input [(ngModel)]="tags" placeholder="Enter tags name" type="text" cols="5" rows="5" name="tags" id="tags" aria-required="true" aria-invalid="true" required>
			</div>

			<div class="form-group">
				<label for="notes"><span>*</span> Notes</label>
				<input [(ngModel)]="notes" placeholder="Enter notes name" type="text" cols="5" rows="5" name="notes" id="notes" aria-required="true" aria-invalid="true" required>
			</div>

			<div class="form-group">
				<label for="description"><span>*</span> Description</label>
				<textarea [(ngModel)]="description" aria-required="true" placeholder="Add case description" name="myTextBox" cols="55" rows="10"></textarea>
			</div>

			<button class="cm-standard-button" (click) = "editCase(name, description, tags, notes)"> Edit Case Details </button>
        <!--
        <div [(ngModel)]="successMessage">{{successMessage}}</div>
        <div [(ngModel)]="errorMessage">{{errorMessage}}</div>
        -->
    </div>
</div>

<!-- Popup for viewing label detection jobs -->
<div class="cm-popup" *ngIf="showViewLabelJobsPopup">
    <div class="cm-popup-content view-label-detection-popup" >
        <div class="cm-popup-close" (click)="closeViewLabelJobsPopup()">
        &times; <!-- &times; is the X icon -->
        </div>
        <h4>Label Detection Jobs</h4>
        <div class="cm-table">
            <div class="cm-table-header">
                <div class="iconCol"></div>
                <div class="tagsCol"><b>Searched Tags</b></div>
                <div class="statusCol"><b>Status</b></div>
            </div>
            <div class="cm-table-body">
                <div *ngFor="let keywords of this.getCaseKeywords()">
                    <div class = "cm-table-row" [class.selected]="keywords === selectedKeywords"
                    (click)="onSelectKeywords(keywords)">
                        <div class="iconCol"><i class="fal fa-video"></i></div>
                        <div class="tagsCol">{{ keywords.tags }}</div>
                        <div class="statusCol" *ngIf="!this.checkForTagsInFinished(keywords.tags)">ANALYZING...</div>
                        <div class="statusCol" *ngIf="this.checkForTagsInFinished(keywords.tags)">FINISHED</div>
                    </div>
                </div>
            </div>
        </div>
        <!--
        <div class="fileTable">
            <div *ngFor="let keywords of this.getCaseKeywords()">
                <div *ngIf="this.checkForTagsInFinished(keywords.tags)" class = "clickableFile" [class.selected]="keywords === selectedKeywords" 
                (click)="onSelectKeywords(keywords)">
                    <div class="fileCol">{{ keywords.tags }}</div>
                </div>
                <div *ngIf="!this.checkForTagsInFinished(keywords.tags)" class = "clickableFile" [class.selected]="keywords === selectedKeywords" 
                >
                    <div class="fileCol">{{ keywords.tags }} (Pending...)</div>
                </div>
            </div>
        </div>
        -->
        <!--
        <div [(ngModel)]="successMessage">{{successMessage}}</div>
        <div [(ngModel)]="errorMessage">{{errorMessage}}</div>
        -->
    </div>
</div>

<div class="cm-popup" *ngIf="showStartLabelJobPopup">
    <div class="cm-popup-content new-label-detection-popup" >
        <div class="cm-popup-close" (click)="closeStartLabelJobPopup()">
        &times; <!-- &times; is the X icon -->
        </div>
        <app-new-label-detection class="new-label-detection-content" (popUpToDetCasePageEmitter)="this.onJobStartedEmission($event)"></app-new-label-detection>
        <!--
        <div [(ngModel)]="successMessage">{{successMessage}}</div>
        <div [(ngModel)]="errorMessage">{{errorMessage}}</div>
        -->
    </div>
</div>